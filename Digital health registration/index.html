<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Health Registration</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Digital Health Registration</h1>
            <p>Your digital key to a healthier future</p>
        </header>

        <main>
            <div class="form-container">
                <form id="registrationForm">
                    <h2>Registration Form</h2>
                    
                    <div class="form-group">
                        <label for="name">Full Name:</label>
                        <input type="text" id="name" name="name" required>
                    </div>

                    <div class="form-group">
                        <label for="date_of_birth">Date of Birth:</label>
                        <input type="date" id="date_of_birth" name="date_of_birth" required>
                    </div>

                    <div class="form-group">
                        <label for="city">City:</label>
                        <input type="text" id="city" name="city" required>
                    </div>

                    <div class="form-group">
                        <label for="email">Email:</label>
                        <input type="email" id="email" name="email" required>
                    </div>

                    <div class="form-group">
                        <label for="blood_group">Blood Group:</label>
                        <select id="blood_group" name="blood_group" required>
                            <option value="">Select Blood Group</option>
                            <option value="A+">A+</option>
                            <option value="A-">A-</option>
                            <option value="B+">B+</option>
                            <option value="B-">B-</option>
                            <option value="AB+">AB+</option>
                            <option value="AB-">AB-</option>
                            <option value="O+">O+</option>
                            <option value="O-">O-</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="aadhar_number">Aadhar Number:</label>
                        <input type="text" id="aadhar_number" name="aadhar_number" pattern="[0-9]{12}" maxlength="12" required>
                        <small>Enter 12-digit Aadhar number</small>
                    </div>

                    <div class="form-buttons">
                        <button type="button" id="nextBtn" onclick="validateAndProceed()">Next</button>
                        <button type="submit" id="submitBtn">Submit</button>
                    </div>
                </form>

                <div id="fingerprintSection" class="fingerprint-section" style="display: none;">
                    <h2>Health Scan</h2>
                    <p>Place your thumb on the sensor for health screening</p>
                    <button type="button" id="fingerprintBtn" class="fingerprint-btn">
                        <span class="fingerprint-icon">ðŸ‘†</span>
                        Fingerprint Sensor
                    </button>
                    <div id="scanResult" class="scan-result"></div>
                </div>
            </div>
        </main>

        <div id="messageArea" class="message-area"></div>
    </div>

    <script>
        let currentUserId = null;

        // Registration form submission
        document.getElementById('registrationForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const data = Object.fromEntries(formData);
            
            try {
                const response = await fetch('/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    currentUserId = result.userId;
                    showMessage(result.message, 'success');
                    document.getElementById('registrationForm').style.display = 'none';
                    document.getElementById('fingerprintSection').style.display = 'block';
                } else {
                    showMessage(result.message, 'error');
                }
            } catch (error) {
                showMessage('Registration failed. Please try again.', 'error');
                console.error('Registration error:', error);
            }
        });

        // Validate form and show next step
        function validateAndProceed() {
            const form = document.getElementById('registrationForm');
            const inputs = form.querySelectorAll('input[required], select[required]');
            let isValid = true;
            
            inputs.forEach(input => {
                if (!input.value) {
                    input.style.borderColor = '#ff6b6b';
                    isValid = false;
                } else {
                    input.style.borderColor = '#4CAF50';
                }
            });
            
            if (isValid) {
                showMessage('Form validation passed. Click Submit to register.', 'success');
                document.getElementById('submitBtn').style.display = 'inline-block';
            } else {
                showMessage('Please fill in all required fields.', 'error');
            }
        }

        // Fingerprint scanning
        document.getElementById('fingerprintBtn').addEventListener('click', async function() {
            if (!currentUserId) {
                showMessage('Please register first.', 'error');
                return;
            }
            
            this.disabled = true;
            this.innerHTML = '<span class="fingerprint-icon">ðŸ”„</span> Scanning...';
            
            // Simulate fingerprint scanning process
            setTimeout(async () => {
                try {
                    const response = await fetch('/fingerprint-scan', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ userId: currentUserId })
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        document.getElementById('scanResult').innerHTML = `
                            <div class="scan-success">
                                <h3>âœ… ${result.message}</h3>
                                <p>${result.healthStatus}</p>
                            </div>
                        `;
                        showMessage('Health scan completed successfully!', 'success');
                    } else {
                        showMessage(result.message, 'error');
                    }
                } catch (error) {
                    showMessage('Fingerprint scan failed. Please try again.', 'error');
                    console.error('Fingerprint scan error:', error);
                }
                
                this.disabled = false;
                this.innerHTML = '<span class="fingerprint-icon">ðŸ‘†</span> Fingerprint Sensor';
            }, 3000); // 3 second simulation
        });

        // Utility function to show messages
        function showMessage(message, type) {
            const messageArea = document.getElementById('messageArea');
            messageArea.innerHTML = `<div class="message ${type}">${message}</div>`;
            
            setTimeout(() => {
                messageArea.innerHTML = '';
            }, 5000);
        }

        // Aadhar number validation
        document.getElementById('aadhar_number').addEventListener('input', function() {
            this.value = this.value.replace(/\D/g, '');
        });
    </script>
</body>
</html>